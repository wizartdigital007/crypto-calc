<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fishing Game</title>
    <style>
        body { margin: 0; display: flex; flex-direction: column; align-items: center; font-family: Arial, sans-serif; }
        #gameCanvas { border: 1px solid #000; background: #87CEEB; }
        #score { font-size: 24px; margin: 10px; }
        #speedControls { margin: 10px; }
        #highScores { margin: 20px; }
        table { border-collapse: collapse; }
        th, td { padding: 8px; border: 1px solid #ccc; }
        button { padding: 5px 10px; margin: 0 5px; }
    </style>
</head>
<body>
    <div id="score">Score: 0</div>
    <div id="speedControls">
        Speed: 
        <button onclick="setSpeed(1)">1</button>
        <button onclick="setSpeed(2)">2</button>
        <button onclick="setSpeed(3)">3</button>
    </div>
    <canvas id="gameCanvas" width="600" height="400"></canvas>
    <div id="highScores">
        <h2>High Scores</h2>
        <table id="scoresTable">
            <thead><tr><th>Rank</th><th>Score</th></tr></thead>
            <tbody id="scoresBody"></tbody>
        </table>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreDisplay = document.getElementById("score");
        const scoresBody = document.getElementById("scoresBody");

        let score = 0;
        let fish = { x: 300, y: 200, width: 50, height: 30, baseSpeed: 2, angle: 0 };
        let highScores = JSON.parse(localStorage.getItem("fishingScores")) || [];

        function drawFish() {
            ctx.fillStyle = "#FF4500";
            ctx.beginPath();
            ctx.ellipse(fish.x, fish.y, fish.width / 2, fish.height / 2, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = "#000";
            ctx.beginPath();
            ctx.arc(fish.x - 10, fish.y - 5, 3, 0, Math.PI * 2); // глаз
            ctx.fill();
            // Отладка: текст с координатами
            ctx.fillStyle = "#FFF";
            ctx.font = "12px Arial";
            ctx.fillText(`x: ${Math.round(fish.x)}, y: ${Math.round(fish.y)}`, fish.x - 20, fish.y - 20);
        }

        function moveFish() {
            fish.angle += 0.05;
            fish.x += fish.baseSpeed;
            fish.y = 200 + Math.sin(fish.angle) * 50; // Волна от центра

            // Простые границы
            if (fish.x > canvas.width + fish.width / 2) fish.x = -fish.width / 2;
            if (fish.x < -fish.width / 2) fish.x = canvas.width + fish.width / 2;
        }

        function setSpeed(level) {
            fish.baseSpeed = level;
        }

        function updateScore() {
            scoreDisplay.innerText = `Score: ${score}`;
            if (score > Math.min(...highScores.concat(0))) {
                highScores.push(score);
                highScores.sort((a, b) => b - a);
                highScores = highScores.slice(0, 5);
                localStorage.setItem("fishingScores", JSON.stringify(highScores));
                updateHighScores();
            }
        }

        function updateHighScores() {
            scoresBody.innerHTML = "";
            highScores.forEach((s, i) => {
                const row = document.createElement("tr");
                row.innerHTML = `<td>${i + 1}</td><td>${s}</td>`;
                scoresBody.appendChild(row);
            });
        }

        canvas.addEventListener("click", (e) => {
            const rect = canvas.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const clickY = e.clientY - rect.top;

            if (clickX > fish.x - fish.width / 2 && clickX < fish.x + fish.width / 2 &&
                clickY > fish.y - fish.height / 2 && clickY < fish.y + fish.height / 2) {
                score += 10;
                fish.x = 300; // Центр
                fish.y = 200;
                fish.angle = 0;
                updateScore();
            }
        });

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Очистка
            moveFish(); // Сначала движение
            drawFish(); // Потом отрисовка
            requestAnimationFrame(gameLoop);
        }

        setSpeed(2);
        updateHighScores();
        ctx.clearRect(0, 0, canvas.width, canvas.height); // Начальная очистка
        drawFish(); // Рисуем сразу
        gameLoop(); // Запускаем цикл
    </script>
</body>
</html>
